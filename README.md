# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- /src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные для товара

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
	inBasket: boolean;
}
```

Данные для заказа

```
interface IOrder {
	payment: string;
	address: string;
	email: string;
	phone: string;
	total: TTotalPrice;
	items: string[];
}
```

Данные для корзины с товарами

```
interface IBasket {
	products: IProduct[];
	total: number | null;
}
```

Данные для каталога товара

```
interface IProductList {
	items: IProduct[];
}
```

Интерфейс главной страницы

```
interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
}
```

Данные для модального окна

```
interface IModalData {
	content: HTMLElement;
}
```

Интерфейс формы

```
interface IFormState {
	valid: boolean;
	errors: string[];
}
```

Интерфейс действия с модальным окном успешного оформления заказа

```
interface ISuccessActions {
	onClick: () => void;
}
```

Интерфейс действия с превью карточки товара

```
interface ICardActions {
	onClick: (event: MouseEvent) => void;
}
```

Тип для ответа от сервера (каталог карточек товара)

```
type TApiResponse = Pick<IProductList, 'items'>;
```

Тип для товара в корзине

```
type TProductInBasket = Pick<IProduct, 'id' | 'title' | 'price' | 'inBasket'>;
```

Тип для общей суммы заказа

```
type TTotalPrice = Pick<IBasket, 'total'>;
```

Тип для модального окна с данными по заказу (способ оплаты и адрес доставки)

```
type TOrderModal = Pick<IOrder, 'payment' | 'address'>;
```

Тип для модального окна контактов покупателя

```
type TContactsModal = Pick<IOrder, 'email' | 'phone'>;
```

Тип для ошибок валидации

```
type TFormErrors = Partial<Record<keyof IOrder, string>>;
```

Тип для способа оплаты

```
type TPayment = 'Online' | 'Cash';
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Базовый класс Model
Абстрактный класс. Базовая модель, чтобы можно было отличить ее от простых объектов с данными. Служит основой для создания моделей данных в приложении.
Конструктор принимает объект data, который содержит частичные данные типа T, и events, который является интерфейсом для работы с событиями. Конструктор инициализирует экземпляр класса, расширяя его данными из data.
- `constructor(data: Partial<T>, protected events: IEvents)`

Методы класса:
- `emitChanges(event: string, payload?: object)` - используется для уведомления о изменениях в модели

#### Класс ProductData
Наследует класс Model.\
Класс отвечает за хранение и логику работы с данными о товарах.\
Поля класса:
- `items: IProduct[]` - каталог товаров на главной странице

Методы класса:
- `setCatalog(cards: IProduct[])` - обновляет каталог товаров и оповещает об изменениях

#### Класс OrderData
Наследует класс Model.\
Отвечает за хранение и логику работы с данными заказа (список купленных товаров, общая стоимость заказа, способ оплаты, адрес доставки, email и телефон покупателя, валидация форм).\
Поля класса:
- `items: string[] = []` - список купленных товаров
- `payment: string = 'Online'` - способ оплаты
- `address: string = ''` - адрес доставки
- `email: string = ''` - email покупателя
- `phone: string = ''` - телефон покупателя
- `formErrors: TFormErrors = {}` - объект с текстами ошибок валидации для конкретных полей
- `valid: boolean = false` - валидность введенных пользователем данных
- `total: number | null = null` - сумма заказа
- `protected events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы класса:
- `validateContacts(): boolean` - проверка правильности ввода email и телефона
- `validatePaymentAddress(): boolean` - проверка правильности выбора способа доставки и ввода адреса доставки
- `clearOrder(): void` - очистка данных заказа

#### Класс BasketData
Наследует класс Model.\
Отвечает за хранение и логику работы с данными о товарах, находящихся в корзине.\
Поля класса:
- `protected _products: IProduct[] = []` - массив с карточками товаров, добавленных в корзину
- `total: number | null = null` - общая стоимость заказа

Методы класса:
- `addToBasket(product: IProduct): void` - добавление товара в корзину
- `deleteFromBasket(product: IProduct): void` - удаление товара из корзины
- `clearBasket(): void` - очищение корзины после успешного заказа
- `get products()` - геттер для получения списка товаров в корзине

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Абстрактный класс.\
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте.
В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента:
- `protected constructor(protected readonly container: HTMLElement)`

#### Класс Page
Наследует класс Component.\
Отвечает за отображение главной страницы сайта.\
В конструктор класса передается HTML элемент контейнера и экземпляр класса `EventEmitter` для возможности инициации событий:
- `constructor(container: HTMLElement, protected events: IEvents)`

Поля класса:
- `protected _counter: HTMLElement` - элемент разметки со счетчиком количества товаров в корзине
- `protected _catalog: HTMLElement` - элемент разметки с каталогом товаров
- `protected _wrapper: HTMLElement` - элемент разметки, обертка страницы (для блокировки прокрутки)
- `protected _basket: HTMLElement` - элемент разметки для отображения корзины

Методы класса:
- `set counter(value: number)` - сеттер для установки счетчика количества товаров в корзине
- `set catalog(items: HTMLElement[])` - сеттер для установки каталога товаров
- `set locked(value: boolean)` - сеттер для блокировки прокрутки страницы

#### Класс Card
Наследует класс Component.\
Отвечает за отображение карточки товара, задавая в карточке данные категории, названия, изображения, стоимости, описания продукта. Класс используется для отображения карточек на странице сайта.\
В конструктор класса передается название блока, контейнер для карточки товара, объект с действиями (необязательный):
- `constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions)`

Поля класса:
- `protected _description: HTMLElement` - элемент разметки с описанием товара
- `protected _image: HTMLImageElement` - элемент разметки с изображением
- `protected _title: HTMLElement` - элемент разметки с наименованием
- `protected _category: HTMLElement` - элемент разметки с категорией
- `protected _price: HTMLElement` - элемент разметки со стоимостью товара
- `protected _button: HTMLButtonElement` - элемент разметки с кнопкой "В корзину"
- `protected _basketItemIndex: HTMLElement` - элемент разметки с порядковым номером карточки в корзине

Методы класса:
- `toogleButtonText(item: IProduct)` - изменяет название кнопки в зависимости от того, в корзине товар или нет
- `set description(value: string)` - сеттер для установки текста с описанием товара
- `set image(value: string)` - сеттер для установки изображения товара
- `set title(value: string)` - сеттер для установки текста с наименованием товара
- `set category(value: string)` - сеттер для установки наименования категории товара
- `set price(value: number | null)` - сеттер для установки значения стоимости товара
- `set basketItemIndex(index: number)` - сеттер для установки порядкового номера карточки в корзине

#### Класс Basket
Наследует класс Component.\
Реализует модальное окно с корзиной товаров.\
При открытии модального окна получает объект с массивом товаров и общую стоимость заказа.\
В конструктор класса передается название блока, контейнер, в котором размещаются карточки товара и экземпляр класса `EventEmitter` для возможности инициации событий:
- `constructor(protected blockName: string, container: HTMLElement, protected events: IEvents)`

Поля класса:
- `protected _list: HTMLElement` - элемент разметки контейнера для товаров
- `protected _total: HTMLElement` - элемент разметки с суммой заказанных товаров
- `protected submitButton: HTMLButtonElement` - кнопка подтверждения

Методы класса:
- `set total(price: number)` - сеттер для установки общей стоимости заказа
- `set items(items: HTMLElement[])` - сеттер для установки списка товаров в корзине

#### Класс Modal
Наследует класс Component.\
Реализует модальное окно.\
В конструктор передается контейнер с содержимым модального окна и экземпляр класса `EventEmitter` для возможности инициации событий:
- `constructor(container: HTMLElement, protected events: IEvents)`

Поля класса:
- `protected _closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `protected _content: HTMLElement` - содержимое модального окна

Методы класса:
- `set content(value: HTMLElement)` - сеттер для установки содержимого модального окна
- `open()` - открытие модального окна
- `close()` - закрытие модального окна
- `render(data: IModalData): HTMLElement` - метод для отрисовки модального окна

#### Класс Form
Наследует класс Component.\
Реализует отображение формы. В проекте предусматривается две формы: форма с выбором способа оплаты и адреса доставки и форма с контактами покупателя.\
В конструктор принимает контейнер формы и экземпляр брокера событий:
- `constructor(protected container: HTMLFormElement, protected events: IEvents)`

Поля класса:
- `protected _submit: HTMLButtonElement` - кнопка подтверждения
- `protected _errors: HTMLElement;` - элемент, в котором отображаются ошибки валидации

Методы класса:
- `protected onInputChange(field: keyof T, value: string)` - ввод данных в форму
- `set valid(value: boolean)` - сеттер, который делает кнопку подтверждения недоступной, если данные введены некорректно
- `set errors(value: string)` - сеттер, который устанавливает текст ошибки валидации
- `render(state: Partial<T> & IFormState)` - отрисовка формы

#### Класс OrderForm
Расширяет класс Form.\
Отображение формы с выбором способа оплаты и адресом покупателя (email и телефон).\
В конструктор передается контейнер и экземпляр брокера событий:
- `constructor(container: HTMLFormElement, events: IEvents)`

Поля формы:
- `protected _card: HTMLButtonElement` - элемент кнопки "Онлайн"
- `protected _cash: HTMLButtonElement` - элемент кнопки "При получении"
- `protected _address: HTMLInputElement` - элемент поля ввода адреса

Методы класса:
- `set address(value: string)` - сеттер, устанавливает значение адреса
- `set payment(value: string)` - сеттер, устанавливает значение способа оплаты

#### Класс ContactsForm
Расширяет класс Form.\
Отображение формы с контактами покупателя (email и телефон).\
В конструктор передается контейнер и экземпляр брокера событий:
- `constructor(container: HTMLFormElement, events: IEvents)`

Поля формы:
- `protected _email: HTMLInputElement` - элемент для ввода почты
- `protected _phone: HTMLInputElement` - элемент для ввода номера телефона

Методы класса:
- `protected onInputChange(field: keyof TContactsModal, value: string): void` - переопределяем метод onInputChange
- `set email(value: string)` - сеттер, устанавливает значение почты
- `set phone(value: string)` - сеттер, устанавливает значение номера телефона

#### Класс Success
Наследует класс Component.\
Предназначен для реализации модального окна успешно оформленного заказа.\
В конструктор класса передается название блока, контейнер, объект с действиями (необязательный)::
- `constructor(blockName: string, container: HTMLElement, actions: ISuccessActions)`

Поля класса:
- `protected _description: HTMLElement` - элемент разметки с суммой заказа
- `protected _button: HTMLButtonElement` - кнопка закрытия "За новыми покупками!"

Методы класса:
- `set total(value: number)` - сеттер для установки суммы заказа в _description

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cards:changed` - изменение массива карточек товаров

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `cardPreview:open` - открытие превью карточки товара
- `basket:open` - открытие модального окна с корзиной
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `product:toBasket` - добавление/удаление товара в корзину из превью
- `basket:delete` - удаление товара из корзины (кнопка удаления в корзине)
- `order:ready` - введены корректные данные в форму заказа товара
- `contacts:ready` - введены корректные данные в форму с контактами
- `basket:submit` - событие, генерируемое при нажатии кнопки оформления заказа в модальном окне корзины
- `order:submit` - событие, генерируемое при нажатии кнопки продолжения оформления заказа в модальном окне заказа товара
- `contacts:submit` - событие, генерируемое при нажатии кнопки оплаты заказа в модальном окне контактов
- `success:close` - событие, генерируемое при нажатии кнопки в модальном окне успешного завершения оформления заказа
- `orderFormErrors:change` - событие, сообщающее об изменении валидации формы заказа
- `contactsFormErrors:change` - событие, сообщающее об изменении валидации формы контактов
- `payment:change` - событие, сообщающее об изменении способа оплаты
- `address:change` - событие, сообщающее об изменении в поле адреса
- `contacts:change` - событие, сообщающее об изменении в форме контактов