# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- /src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные для товара

```
interface IProduct {
	id: string;
	description?: string;
	image: string;
	title: string;
	category: string;
	price: number;
	inBasket?: boolean;
}
```

Данные для заказа

```
interface IOrder {
	payment: TPayment;
	address: string;
	email: string;
	phone: string;
}
```

Данные для корзины с товарами

```
interface IBasket {
	items: TProductInBasket[];
	total: number;
}
```

Данные для отправки на сервер POST запроса при заказе

```
interface IOrderData extends IOrder{
	total: TTotalPrice;
	items: string[];
}
```

Данные успешного ответа от сервера при отправке заказа

```
interface IOrderResult { 
	id: string;
	total: number;
}
```

Данные для каталога товара

```
interface IProductList {
	items: IProduct[];
	preview: string | null;
}
```

Тип для товара в корзине

```
type TProductInBasket = Pick<IProduct, 'id' | 'title' | 'price'> & { index: number };
```

Тип для общей суммы заказа

```
type TTotalPrice = Pick<IBasket, 'total'>;
```

Тип способа оплаты

```
type TPayment = 'Online' | 'Cash';
```

Тип для модального окна выбора способа оплаты и ввода адреса

```
type TPaymentModal = Pick<IOrder, 'payment' | 'address'>;
```

Тип для модального окна контактов покупателя

```
type TContactsModal = Pick<IOrder, 'email' | 'phone'>;
```

Тип для модального окна успешного оформления заказа

```
type TSucsessModal = Pick<IOrderResult, 'total'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными о товарах.\
Поля класса:
- `items: IProduct[]` - каталог товаров на главной странице
- `preview: string | null` - для просмотра выбранного товара в отдельном попапе

Методы класса:
- `getProductCard(id: string): IProduct` - получение выбранной карточки товара по id для просмотра
- `updateProductCard(card: IProduct): void` - обновление информации о товаре после добавления его в корзину
- а также сеттеры и геттеры для сохранения и получения данных из полей класса


#### Класс OrderData
Отвечает за хранение и логику работы с данными при оформлении заказа (выбор способа оплаты, адрес доставки, email и телефон покупателя).\
Поля класса:
- `payment: TPayment` - способ оплаты
- `address: string` - адрес доставки
- `email: string` - email покупателя
- `phone: string` - телефон покупателя

Методы класса:
- `getPayment(payment: TPayment): string` - выбор способа оплаты заказа
- `setAddress(address: string): string` - ввод адреса доставки
- `setEmail(email: string): string` - ввод email
- `setPhone(phone: string): string` - ввод номера телефона
- `validateContacts(data: Record<keyof TContactsModal, string>): boolean` - проверка правильности ввода email и телефона
- `validatePaymentAddres(data: Record<keyof TPaymentModal, string>): boolean` - проверка правильности выбора способа доставки и ввода адреса доставки
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketData
Отвечает за хранение и логику работы с данными о товарах, находящихся в корзине.\
Поля класса:
- `items: TProductInBasket[]` - массив с карточками товаров, добавленных в корзину
- `total: number` - общая стоимость заказа

Методы класса:
- `addProduct(product: TProductInBasket): void` - добавление товара в корзину
- `deleteProduct(id: string): void` - удаление товара из корзины
- `getTotalPrice(): number` - получение общей суммы заказа
- `clearBasket(): void` - очищение корзины после успешного заказа
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Card 
Отвечает за отображение карточки товара, задавая в карточке данные категории, названия, изображения, стоимости, описания продукта. Класс используется для отображения карточек на странице сайта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки, а также принимает экземпляр `EventEmitter` для инициации событий:
- `constructor(template: HTMLTemplateElement, events: IEvents)`

Поля класса:
- `description: HTMLElement` - элемент разметки с описанием товара
- `image: HTMLImageElement` - элемент разметки с изображением
- `title: HTMLElement` - элемент разметки с наименованием
- `category: HTMLElement` - элемент разметки с категорией
- `price: HTMLElement` - элемент разметки со стоимостью товара
- `events: IEvents` - брокер событий

Методы класса:
- `setData(cardData: IProduct): void` - заполняет атрибуты элементов карточки.

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице.\
В конструктор принимает контейнер, в котором размещаются карточки:
- `constructor(container: HTMLElement)`

Поля класса:
- `catalog: HTMLElement[]` - каталог с карточками товара

Методы класса:
- `setCatalog()` - загружает массив карточек товара на страницу

#### Класс CadrBasket
Отвечает за отображение товара в корзине, показывает порядковый номер, наименование и стоимость товара.\
В конструктор класса передаётся DOM элемент темплейта, что позволяет при необходимости формировать элемент товара в разных вариантов вёрстки:
- `constructor(template: HTMLTemplateElement, events: IEvents)`

Поля класса:
- `id: string` - id товара
- `title: HTMLElement` - элемент разметки с названием товара
- `index: HTMLElement` - элемент разметки с номером товара в списке корзины
- `price: HTMLElement` - элемент разметки с ценой товара
- `button: HTMLButtonElement` - кнопка удаления товара из корзины

Методы класса:
- `setData(cardData: TProductInBasket): void` - заполняет атрибуты элементов карточки в корзине.

#### Класс BasketTotalPrice
Отвечает за отображение общей суммы заказа на главной странице.

Поля класса:
- `basketCounter: HTMLElement` - счетчик общей суммы заказа

Методы класса:
- `setBasketCounter(value: number)` - устанавливает общую сумму заказа

#### Класс Modal
Реализует модальное окно.\
Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
В конструктор передается селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий:
- `constructor(selector: string, events: IEvents)`

Поля класса:
- `modal: HTMLElement` - элемент модального окна
- `events: IEvents` - брокер событий

Методы класса:
- `open()` - открытие модального окна
- `close()` - закрытие модального окна

#### Класс ModalCardPreview
Расширяет класс Modal. Реализует модальное окно с карточкой товара.\
При открытии модального окна получает данные товара (категория, наименование, описание, стоимость), которые нужно отобразить.\
В конструктор передается селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий:
- `constructor(selector: string, events: IEvents)`

Поля класса
- `cardImage: HTMLImageElement` - элемент разметки с изображением
- `cardCategory: HTMLElement` - элемент разметки с категорией
- `cardTitle: HTMLElement` - элемент разметки с наименованием
- `cardDescription: HTMLElement` - элемент разметки с описанием товара
- `cardPrice: HTMLElement` - элемент разметки со стоимостью товара
- `events: IEvents` - брокер событий

Методы класса:
- `open(data: { description: string, image: string, title: string, category: string, price: number }): void` - расширение родительского метода, принимает данные товара, которые используются для заполнения атрибутов элементов модального окна.
- `close(): void` - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.

#### Класс ModalBasket
Расширяет класс Modal. Реализует модальное окно с корзиной товаров.\
При открытии модального окна получает объект с массивом товаров и общую стоимость заказа.\
В конструктор передается контейнер, в котором размещаются карточки товара и экземпляр класса `EventEmitter` для возможности инициации событий:
- `constructor(container: HTMLUListElement, events: IEvents)`

Поля класса:
- `list: HTMLElement` - элемент разметки контейнера для товаров
- `total: HTMLElement` - элемент разметки с суммой заказанных товаров
- `submitButton: HTMLButtonElement` - кнопка подтверждения

Методы класса:
- `updateIndex(): void` - обновляет порядковые номера товаров
- `disableButton(): void` - делает кнопку «Оформить» неактивной
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс ModalWithForm
Расширяет класс Modal. Реализует модальное окно с с формой, содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки подтверждения.\
В конструктор принимает контейнер и экземпляр брокера событий:
- `constructor(container: HTMLElement, events: IEvents)`

Поля класса:
- `submitButton: HTMLButtonElement` - кнопка подтверждения
- `_form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута name формы
- `errors: Record<string, HTMLElement>` - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы

Методы класса:
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода
- `close (): void` - расширяет родительский метод дополнительно при закрытии, очищая поля формы и деактивируя кнопку подтверждения
- `get form: HTMLElement` - геттер для получения элемента формы

#### Класс ModalWithFormOrder
Расширяет класс ModalWithForm. Устанавливает слушатели событий на кнопки в выборе оплаты.\
В конструктор передается контейнер и экземпляр брокера событий:
- `constructor(container: HTMLFormElement, events: IEvents)`

Поля формы:
- `paymentButtons: NodeListOf<HTMLButtonElement>` - кнопки выбора способа оплаты

#### Класс ModalSucsess
Расширяет класс Modal. Предназначен для реализации модального окна успешно оформленного заказа. Устанавливает слушатель на кнопку завершения для закрытия окна.
В конструктор передается контейнер и экземпляр брокера событий:
- `constructor(container: HTMLElement, events: IEvents)`

Поля класса:
- `_description: HTMLElement` - элемент разметки с суммой заказа
- `button: HTMLButtonElement` - кнопка закрытия "За новыми покупками!"

Методы класса:
- сеттер для установки суммы заказа в _description

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cards:changed` - изменение массива карточек товаров
- `card:selected` - изменение открываемой в модальном окне карточки товара
- `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `cardPreview:open` - открытие модального окна с превью карточки товара
- `basket:open` - открытие модального окна с корзиной
- `product:add` - добавление товара в корзину
- `product:remove` - удаление товара из корзины
- `order:input` - изменение данных в форме заказа товара
- `contacts:input` - изменение данных в форме указания контактов
- `cardPreview:submit` - событие, генерируемое при нажатии кнопки добавления в корзину в модальном окне превью карточки товара
- `basket:submit` - событие, генерируемое при нажатии кнопки оформления заказа в модальном окне корзины
- `order:submit` - событие, генерируемое при нажатии кнопки продолжения оформления заказа в модальном окне заказа товара
- `contacts:submit` - событие, генерируемое при нажатии кнопки оплаты заказа в модальном окне контактов
- `sucsess:submit` - событие, генерируемое при нажатии кнопки в модальном окне успешного завершения оформления заказа
- `cardPreview:validation` - событие, сообщающее о необходимости валидации карточки товара (добавлен товар в корзину или нет)
- `basket:validation` - событие, сообщающее о необходимости валидации корзины
- `order:validation` - событие, сообщающее о необходимости валидации формы заказа
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактов